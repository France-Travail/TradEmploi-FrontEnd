<ng-container *ngFor="let messageWrapped of messagesWrapped; let i = index">
  <div *ngIf="messageWrapped.notification" class="notification">{{ messageWrapped.notification }}</div>
  <div *ngIf="messageWrapped.message" [ngClass]="messageWrapped.message.role === 'DE' ? 'user' : 'advisor'">
    <mat-card *ngIf="!shared && messageWrapped.message" class="bubble">
      <div class="flag">
        <span *ngIf="messageWrapped.message.flag !== 'xa'" class="flag-icon flag-icon-{{ messageWrapped.message.flag }}"></span>
        <img *ngIf="messageWrapped.message.flag === 'xa'" class="flag-icon" src="assets/images/arab-flag.png" alt="drapeau" />
      </div>
      <div *ngIf="messageWrapped.message" class="message-sended">
        <div class="text">
          <span>
            <div *ngIf="!visible; then longText; else shortText"></div>
            <ng-template #shortText>
              <a class="incoming-message" dir="auto" [ngStyle]="{ 'text-align': messageWrapped.message.languageOrigin === 'ar-XA' ? 'right' : 'left' }">
                <bdi>{{ messageWrapped.message.text }}</bdi>
              </a>
              <a class="extand" *ngIf="messageWrapped.message.text !== undefined && messageWrapped.message.text.length > 98" (click)="extand()">
                <img src="./assets/icons/icon-chevron-close-blue.svg" alt="réduire le texte" />
              </a>
            </ng-template>
            <ng-template #longText>
              <a class="incoming-message" dir="auto" [ngStyle]="{ 'text-align': messageWrapped.message.languageOrigin === 'ar-XA' ? 'right' : 'left' }" lang="ar">
                <bdi>{{ messageWrapped.message.text | slice: 0:98 }}</bdi>
                <strong *ngIf="messageWrapped.message.text !== undefined && messageWrapped.message.text.length > 98">...</strong>
              </a>
              <a class="extand" *ngIf="messageWrapped.message.text !== undefined && messageWrapped.message.text.length > 98" (click)="extand()">
                <img src="./assets/icons/icon-chevron-open-blue.svg" alt="étendre le texte" />
              </a>
            </ng-template>
          </span>
        </div>
      </div>
      <div class="translation">
        <div id="{{ 'msg-translate-' + i }}" dir="auto" [ngStyle]="{ 'text-align': messageWrapped.message.target === 'ar-XA' ? 'right' : 'left' }">
          <bdi>{{ messageWrapped.message.translation }}</bdi>
        </div>
        <a class="listen" (click)="listen(i)" *ngIf="messageWrapped.message.audioHtml">
          <img src="../../../assets/icons/icon-listen-black.svg" alt="Ecoute de la traduction" />
        </a>
      </div>
    </mat-card>
  </div>
</ng-container>
