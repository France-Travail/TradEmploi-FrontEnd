<ng-container *ngFor="let messageWrapped of messagesWrapped; let i = index">

  <div *ngIf="messageWrapped.notification " class="notification ">
    <span class="notificationText">{{ messageWrapped.notification }}</span>
    <button *ngIf="i!=0 && isAudioSupported" class="listen" (click)="listenToMessage(i)"></button>
  </div>

  <div *ngIf="messageWrapped.message" [ngClass]="messageWrapped.message.role === 'DE' ? 'bubble-area-user' : 'bubble-area-advisor'">
    <div [ngClass]="messageWrapped.message.role === 'DE' ? 'user' : 'advisor'">
      <div *ngIf="messageWrapped.message && messageWrapped.message.role === 'DE'; then user; else advisor"></div>
      <ng-template #user>
        <div class="bubbleTitle">
          <div>
            <span *ngIf="messageWrapped.message.flag !== 'xa'" class="flag-icon flag-icon-{{ messageWrapped.message.flag }}"></span>
            <img *ngIf="messageWrapped.message.flag === 'xa'" class="flag-icon" src="assets/images/arab-flag.png" alt="drapeau" />
            <span>&nbsp;Participant</span>
          </div>
        </div>
      </ng-template>
      <ng-template #advisor>
        <div class="bubbleTitle">
          <div>
            <img src="assets/icons/logo-pe.svg" alt="pole emploi" class="logo" />
            <span>&nbsp;{{firstName}}</span>
          </div>
        </div>
      </ng-template>
      <div *ngIf="messageWrapped.message.text.length > 99; then longText; else shortText"></div>
      <ng-template #shortText>
        <div class="messageRaw">
          {{ messageWrapped.message.text }}
        </div>
        <div class="messageTranslated">
          <bdi>{{ messageWrapped.message.translation }}</bdi>
        </div>
      </ng-template>
      <ng-template #longText>
        <div class="messageRaw" [ngStyle]="{ height: messageNumberToFold === i ? '100%' : '1.2em' }">
          {{ messageWrapped.message.text }}
        </div>
        <div class="unfold-word" (click)="unFold(i)">
          {{ messageNumberToFold === i ? foldMessage(messageWrapped.message) : unFoldMessage(messageWrapped.message) }}
        </div>
        <!-- <div *ngIf="messageWrapped.message && messageWrapped.message.role === 'DE'; then foldEN; else foldFR"></div>
        <ng-template #foldEN>
          <div class="unfold-word" (click)="unFold(i)">{{ messageNumberToFold === i ? '[See less]' : '[See more]' }}</div>
        </ng-template>
        <ng-template #foldFR>
          <div class="unfold-word" (click)="unFold(i)">{{ messageNumberToFold === i ? '[Voir moins]' : '[Voir plus]' }}</div>
        </ng-template> -->
        <div class="messageTranslated">
          <bdi>{{ messageWrapped.message.translation }}</bdi>
        </div>
      </ng-template>
    </div>
    <div class="listen" (click)="listen(i)" *ngIf="messageWrapped.message.audioHtml"></div>
  </div>
</ng-container>
